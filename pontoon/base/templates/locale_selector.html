{% import 'widgets/latest_activity.html' as LatestActivity %}
{% import 'widgets/progress_chart.html' as ProgressChart %}

<!-- Locale selector -->
<div class="locale select">
  {% if locale and locale.code != '' %}
  <div class="button breadcrumbs selector noselect">
    <span class="language" data-locale-code="{{ locale.code }}">{{ locale.name }}</span><span class="code">{{ locale.code }}</span>
  </div>
  {% endif %}
  <div class="menu">
    <div class="search-wrapper clearfix">
      <div class="icon fa fa-search"></div>
      <input type="search" autocomplete="off" autofocus>
    </div>
    {% if not locale %}
    <div class="sort clearfix">
      <span class="language asc">Language<i class="fa"></i></span>
      <span class="locale">Locale<i class="fa"></i></span>
      <span class="latest">Latest activity<i class="fa"></i></span>
      <span class="progress">Progress<i class="fa"></i></span>
    </div>
    {% endif %}
    <ul>
      {% for l in locales %}
        {% if project %}
          {% set link = url('pontoon.locale.project', l.code, project.slug) %}
        {% else %}
          {% set link = url('pontoon.locale', l.code) %}
        {% endif %}
        <li class="clearfix">
          <span class="language {{ l.code|lower }}"
            data-locale-code="{{ l.code }}"
            {% if project and locale %}
              {% for key, value in l.serialize().iteritems() %}
                data-{{ key }}="{{ value }}"
              {% endfor %}
              {% if locale == l %}
                data-projects="{{ l.available_projects_list()|to_json }}"
              {% endif %}
            {% endif %}
          >
            {% if not locale %}<a href="{{ link }}" class="clearfix">{% endif %}
              {{ l.name }}
            {% if not locale %}</a>{% endif %}
          </span>

          <span class="code">
            {% if not locale %}<a class="code" href="{{ link }}" class="clearfix">{% endif %}
              {{ l.code }}
            {% if not locale %}</a>{% endif %}
          </span>

          {% if not locale %}
            {{ LatestActivity.span(l.get_latest_activity(project|default(none))) }}

            {% if l.total_strings %}
              {% set chart = l.get_chart(project|default(none)) %}
              {{ ProgressChart.span(chart, link) }}
            {% endif %}
          {% endif %}
        </li>
      {% endfor %}
      <li class="no-match">No results</li>
    </ul>
  </div>
</div>
